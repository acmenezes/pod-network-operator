apiVersion: v1
kind: ServiceAccount
metadata:
  name: cnf-telco-sa
  namespace: cnf-telco
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  creationTimestamp: null
  name: pod-network-config-role
  namespace: cnf-telco
rules:
- apiGroups:
  - podnetwork.opdev.io/v1alpha1
  resources:
  - podnetworkconfig
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch  
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: pod-network-config-rolebinding
  namespace: cnf-telco
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: pod-network-config-role
subjects:
- kind: ServiceAccount
  name: cnf-telco-sa
  namespace: cnf-telco
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cnf-example-a
  namespace: cnf-telco
  labels:
    podNetworkConfig: podnetwork-sample-a
spec:
  selector:
    matchLabels:
      podNetworkConfig: podnetwork-sample-a
  replicas: 2
  template:
    metadata:
      name: cnf-example-a
      namespace: cnf-telco
      labels:
        podNetworkConfig: podnetwork-sample-a
    spec:
      serviceAccountName: cnf-telco-sa
      containers:
      - command:
        - /bin/bash 
        - -c 
        - --
        args:
        - "while true; do sleep 30; done;"
        image: "nicolaka/netshoot:latest"
        imagePullPolicy: Always
        name: cnf-example
      nodeSelector:
        cnf-telco: "true"        
